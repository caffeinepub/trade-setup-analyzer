{
  "kind": "build_request",
  "title": "Fix Yahoo Finance market data fetching failure",
  "projectName": "Trade Setup Analyzer",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-30",
      "text": "Investigate and fix the 'fail to fetch data' error in the Yahoo Finance integration by adding comprehensive error logging to frontend/src/lib/marketData/fetchMarketData.ts to capture the exact failure point: HTTP response status, response headers, raw response body, parsed error messages, and network exceptions.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-fail-to-fetch"
        ],
        "quotes": [
          "it says fail to fetch data"
        ]
      },
      "acceptanceCriteria": [
        "Console logs show the exact HTTP status code and response body when the fetch fails",
        "Error logs distinguish between network failures, HTTP errors, and parsing failures",
        "Logs are written at debug level and do not expose sensitive data"
      ]
    },
    {
      "id": "REQ-31",
      "text": "Verify that the Yahoo Finance API endpoint URL constructed in frontend/src/lib/marketData/fetchMarketData.ts is correctly formatted and matches Yahoo Finance's expected chart API format, including all required query parameters (interval, range, symbol encoding).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-fail-to-fetch"
        ]
      },
      "acceptanceCriteria": [
        "The constructed URL matches Yahoo Finance's documented chart API format",
        "Ticker symbols are properly URL-encoded",
        "All required query parameters are present with valid values"
      ]
    },
    {
      "id": "REQ-32",
      "text": "Add CORS and network connectivity error handling to frontend/src/lib/marketData/fetchMarketData.ts to detect and provide specific error messages for common failure modes: CORS policy blocks, network timeouts, DNS resolution failures, and SSL/TLS errors.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-fail-to-fetch"
        ]
      },
      "acceptanceCriteria": [
        "CORS errors display a user-friendly message explaining the browser policy block",
        "Network timeout errors suggest checking connectivity",
        "Each error type returns a distinct MarketDataError code"
      ]
    },
    {
      "id": "REQ-33",
      "text": "Update frontend/src/hooks/useMarketData.ts to display the raw error message from the fetch operation when market data fails, so users and developers can see the exact failure reason in the UI.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-fail-to-fetch"
        ]
      },
      "acceptanceCriteria": [
        "The error display in App.tsx shows the complete error message from useMarketData",
        "Error text includes technical details when in diagnostic mode",
        "Generic 'fail to fetch data' messages are replaced with specific error descriptions"
      ]
    },
    {
      "id": "REQ-34",
      "text": "Test the Yahoo Finance integration with valid ticker symbols (AAPL, MSFT, TSLA) in both browser console and production environment to verify successful data fetching and identify any environment-specific issues (localhost vs. deployed canister).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-fail-to-fetch"
        ]
      },
      "acceptanceCriteria": [
        "Market data successfully loads for valid tickers in development environment",
        "Market data successfully loads for valid tickers in deployed canister environment",
        "Error messages clearly indicate whether the failure is environment-specific"
      ]
    }
  ],
  "constraints": [
    "Do not change the backend Motoko actor implementation",
    "Preserve the existing market data client caching and retry logic",
    "Maintain compatibility with the current DiagnosticPanel component interface"
  ],
  "nonGoals": [
    "Switching to a different market data provider",
    "Adding authentication or API keys for Yahoo Finance",
    "Implementing real-time WebSocket data feeds"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}